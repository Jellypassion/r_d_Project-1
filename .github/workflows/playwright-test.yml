name: Playwright CI Tests
on:
  push:
    branches: [ main, master, lesson-22 ]
  pull_request:
    branches: [ main ]
jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: 'Lesson_22'
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: 24.x
    - name: Install dependencies
      run: npm ci
    - name: Install Playwright Browsers
      run: npx playwright install --with-deps chromium
    - name: Run Playwright tests
      run: npm run test

    - name: Debug - show files
      run: |
        echo "PWD: $(pwd)"
        echo "Workspace root content:"
        ls -la
        echo "Tree (3 levels):"
        find . -maxdepth 3 -type d -print
        echo "Playwright report dir listing (if present):"
        ls -la playwright-report || true
        echo "Allure results dir listing (if present):"
        ls -la allure-results || true
        echo "Allure report dir listing (if present):"
        ls -la allure-report || true

    - uses: actions/upload-artifact@v4
      if: ${{ !cancelled() }}
      with:
        name: playwright-report
        path: playwright-report/**
        retention-days: 30

    - name: Generate Allure Single-file report
      run: |
        npx allure generate allure-results --single-file --clean -o allure-report-single-file
      # working-directory: ${{ env.BUILD_FOLDER }}

    - uses: actions/upload-artifact@v4
      if: ${{ !cancelled() }}
      with:
        name: upload allure-report-single-file
        path: allure-report-single-file/**
        retention-days: 30
